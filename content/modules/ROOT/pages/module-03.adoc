= Lab Guide: Using the Ansible Development Environment
:doctype: book
:experimental:
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_A guide to exploring what `ansible-creator` and the Ansible Development Environment (`ade`) can do for your collection._

---

== Lab Briefing

In this challenge, you will explore the content that was automatically generated for the collection you just created.

image::image.png[Generated collection files in VS Code Explorer, opts="border"]

---

== Lab Guide: Hands-On Tasks

You will now set up your Ansible development environment, check the scaffolded collection content, and add a dependency to your collection to see how the new `ade` tool helps manage it.

=== Task 1: Activate the Ansible Development Environment

First, you will activate the Python virtual environment (`.venv`) that `ansible-creator` created for you.

.   **View the generated files** in the left sidebar of VS Code. You can see the list of all files generated by Ansible Creator.
+
image::image.png[List of scaffolded collection files, opts="border"]

.   **Open the `galaxy.yml` file** by clicking on it in the left sidebar.

.   **Activate the Python virtual environment** by clicking the banner that reads **Select Python Interpreter** in the bottom status bar of VS Code. From the dropdown menu that appears at the top, select the recommended option: **Python 3.11.11 ('.venv': venv)**.
+
image::image.png[Selecting the Python virtual environment in VS Code, opts="border"]

NOTE: This is a convenient alternative to manually running `source .venv/bin/activate` in the terminal.

=== Task 2: Add Collection Dependencies

The Ansible Development Environment (`ade`) tool helps manage dependencies for your collections. Let's add a requirement to see it in action.

.   **Explore the scaffolded files.** Take a moment to explore the content of these auto-generated files (do not edit them yet):
* `.gitignore`: This is pre-loaded with settings to ignore common temporary files, making your Git commits cleaner.
* `test-requirements.txt`: This already includes the Python dependencies required for running tests with Molecule.

.   **Edit the `galaxy.yml` file** by clicking on it in the left sidebar to open it. Modify the `dependencies:` block to add `ansible.posix`. The result should look like this:
+
[source,yaml]
----
dependencies:
  "ansible.utils": "*"
  "ansible.posix": "*"
----

.   **Save the file** using the menu (`File` → `Save`) or by pressing `Ctrl + S` (`Cmd + S` on Mac).

=== Task 3: Check Tool Versions

Let's check the versions of the Ansible development tools installed in your environment.

.   **Open the Terminal in VS Code** from the top menu by clicking **View** → **Terminal**.

.   **Check the tool versions** by running the following command to see the versions of all installed tools:
+
[source,bash]
----
adt --version
----
+
[WARNING]
====
Notice the command is `adt` (Ansible Development Tools). In the next task, you will use `ade` (Ansible Development Environment). These are different tools.
====
+
The output should look similar to this (versions may differ):
+
[source,text]
----
(.venv) [rhel@ansible mycollection]$ adt --version
ansible-builder              3.1.0
ansible-core                 2.18.5
ansible-creator              25.4.1
ansible-dev-environment      25.4.0
ansible-dev-tools            25.5.1
ansible-lint                 25.4.0
ansible-navigator            25.4.1
ansible-sign                 0.1.1
molecule                     25.4.0
pytest-ansible               25.4.1
tox-ansible                  25.4.0
----

=== Task 4: Manage Dependencies with `ade`

Now you will use `ade` to install the dependencies you declared in `galaxy.yml`.

.   **Install the collection dependencies** by running the following command in the VS Code terminal. This will install your collection and its dependencies into the virtual environment.
+
[IMPORTANT]
====
Notice the `.` (dot) at the end of the command. This tells `ade` to operate on the current directory.
====
+
[source,bash]
----
ade install -e .
----
+
The output should look like this:
+
[source,text]
----
 (.venv) [rhel@ansible myansible]$ ade install -e .
 Running ansible-galaxy to install a local collection and it's dependencies
 Note: Installed collections include: ansible.utils and mynamespace.mycollection
 Note: All python requirements are installed.
 Note: All required system packages are installed.
----

.   **Check the dependency tree** by running `ade tree -v` to see the installed dependencies.

.   **Add another collection dependency** by going back to the `galaxy.yml` file and adding `"ansible.netcommon": "*"` to the `dependencies:` list. Save the file. The result should look like this:
+
[source,yaml]
----
dependencies:
  "ansible.utils": "*"
  "ansible.posix": "*"
  "ansible.netcommon": "*"
----

.   **Attempt to re-run the installation** by running the `ade install -e .` command again in the terminal.
+
[WARNING]
====
The command will fail. Don't panic! This is expected. `ade` has detected that `ansible.netcommon` requires certain system-level packages that are not installed on your workstation's operating system.
image::image.png[Command failure showing missing system packages, opts="border"]
====

.   **Install the system dependencies** by running the following command in the VS Code terminal to install the missing OS packages:
+
[source,bash]
----
sudo dnf install -y python3-cffi python3-cryptography python3-lxml python3-pycparser
----

.   **Re-run the `ade` installation.** Now, run `ade install -e .` one more time in the terminal. It should succeed.

.   **Check the new dependency tree.** Finally, run `ade tree -v` again. The output will now show that `ade` has successfully added the `ansible.netcommon` collection to your environment, along with its Python requirements.

NOTE: Remember the "Install collection from source code (editable mode)" option you selected during the Collection creation wizard? That option used `ade` to automatically create the virtual environment (`.venv`) that you are using now.

---
== Next Steps

You have successfully explored the Ansible Development Environment. Please click the **Next** button below to proceed to the next challenge.
